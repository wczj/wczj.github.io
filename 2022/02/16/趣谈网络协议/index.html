<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>趣谈网络协议 | 大炮的博客</title>

  <!-- keywords -->
  

  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="通信协议综述为什么要学习网络协议？12要打造互联网世界的通天塔，只教给一台机器做什么是不够的，你需要学会教给一大片机器做什么。这就需要网络协议通过网络协议，才能使一大片机器互相协作、共同完成一件事。   网络分层123为什么分层： 复杂的程序都分层，程序设计要求层层封装： 只要是在网络上跑的包，都是完整的。可以有下层没上层，绝对不可能有上层没下层。  ifconfig 命令12345678linu">
<meta property="og:type" content="article">
<meta property="og:title" content="趣谈网络协议">
<meta property="og:url" content="http://wczj.github.io/2022/02/16/%E8%B6%A3%E8%B0%88%E7%BD%91%E7%BB%9C%E5%8D%8F%E8%AE%AE/index.html">
<meta property="og:site_name" content="大炮的博客">
<meta property="og:description" content="通信协议综述为什么要学习网络协议？12要打造互联网世界的通天塔，只教给一台机器做什么是不够的，你需要学会教给一大片机器做什么。这就需要网络协议通过网络协议，才能使一大片机器互相协作、共同完成一件事。   网络分层123为什么分层： 复杂的程序都分层，程序设计要求层层封装： 只要是在网络上跑的包，都是完整的。可以有下层没上层，绝对不可能有上层没下层。  ifconfig 命令12345678linu">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="http://wczj.github.io/2022/02/16/%E8%B6%A3%E8%B0%88%E7%BD%91%E7%BB%9C%E5%8D%8F%E8%AE%AE/%E7%BD%91%E7%BB%9C%E5%8D%8F%E8%AE%AE%E5%88%97%E4%B8%BE.png">
<meta property="og:image" content="http://wczj.github.io/2022/02/16/%E8%B6%A3%E8%B0%88%E7%BD%91%E7%BB%9C%E5%8D%8F%E8%AE%AE/32%E4%BD%8DIP%E5%9C%B0%E5%9D%80%E5%88%86%E7%B1%BB.png">
<meta property="og:image" content="http://wczj.github.io/2022/02/16/%E8%B6%A3%E8%B0%88%E7%BD%91%E7%BB%9C%E5%8D%8F%E8%AE%AE/ABC%E7%B1%BBIP%E6%9C%80%E5%A4%A7%E4%B8%BB%E6%9C%BA%E6%95%B0.png">
<meta property="og:image" content="http://wczj.github.io/2022/02/16/%E8%B6%A3%E8%B0%88%E7%BD%91%E7%BB%9C%E5%8D%8F%E8%AE%AE/PXE%E5%B7%A5%E4%BD%9C%E8%BF%87%E7%A8%8B.png">
<meta property="article:published_time" content="2022-02-16T11:53:19.000Z">
<meta property="article:modified_time" content="2022-02-17T01:58:00.348Z">
<meta property="article:author" content="王大炮">
<meta property="article:tag" content="网络协议">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://wczj.github.io/2022/02/16/%E8%B6%A3%E8%B0%88%E7%BD%91%E7%BB%9C%E5%8D%8F%E8%AE%AE/%E7%BD%91%E7%BB%9C%E5%8D%8F%E8%AE%AE%E5%88%97%E4%B8%BE.png">
  
    <link rel="alternative" href="/atom.xml" title="大炮的博客" type="application/atom+xml">
  
  
    <link rel="icon" href="https://bucket-chao.oss-cn-shanghai.aliyuncs.com/test/avatar.jpg">
  
  
<link rel="stylesheet" href="/css/style.css">

  
  

  
<script src="//cdn.bootcss.com/require.js/2.3.2/require.min.js"></script>

  
<script src="//cdn.bootcss.com/jquery/3.1.1/jquery.min.js"></script>


  
<meta name="generator" content="Hexo 5.4.0"></head>
<body>
  <div id="container">
    <div id="particles-js"></div>
    <div class="left-col">
    <div class="overlay"></div>
<div class="intrude-less">
	<header id="header" class="inner">
		<a href="/" class="profilepic">
			
			<img lazy-src="https://bucket-chao.oss-cn-shanghai.aliyuncs.com/test/avatar.jpg" class="js-avatar">
			
		</a>

		<hgroup>
		  <h1 class="header-author"><a href="/"></a></h1>
		</hgroup>

		

		
			<div class="switch-btn">
				<div class="icon">
					<div class="icon-ctn">
						<div class="icon-wrap icon-house" data-idx="0">
							<div class="birdhouse"></div>
							<div class="birdhouse_holes"></div>
						</div>
						<div class="icon-wrap icon-ribbon hide" data-idx="1">
							<div class="ribbon"></div>
						</div>
						
						
					</div>
					
				</div>
				<div class="tips-box hide">
					<div class="tips-arrow"></div>
					<ul class="tips-inner">
						<li>菜单</li>
						<li>标签</li>
						
						
					</ul>
				</div>
			</div>
		

		<div class="switch-area">
			<div class="switch-wrap">
				<section class="switch-part switch-part1">
					<nav class="header-menu">
						<ul>
						
							<li><a href="/">主页</a></li>
				        
							<li><a href="/archives">所有文章</a></li>
				        
						</ul>
					</nav>
					<nav class="header-nav">
						<div class="social">
							
						</div>
					</nav>
				</section>
				
				
				<section class="switch-part switch-part2">
					<div class="widget tagcloud" id="js-tagcloud">
						<a href="/tags/linux/" style="font-size: 10px;">linux</a> <a href="/tags/%E4%B8%AD%E6%96%AD%E5%BC%82%E5%B8%B8/" style="font-size: 10px;">中断异常</a> <a href="/tags/%E5%8D%B3%E6%97%B6%E9%80%9A%E8%AE%AF/" style="font-size: 10px;">即时通讯</a> <a href="/tags/%E5%90%8C%E6%AD%A5%E4%BA%92%E6%96%A5/" style="font-size: 10px;">同步互斥</a> <a href="/tags/%E5%A4%84%E7%90%86%E5%99%A8%E8%B0%83%E5%BA%A6/" style="font-size: 10px;">处理器调度</a> <a href="/tags/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/" style="font-size: 20px;">操作系统</a> <a href="/tags/%E7%AE%80%E4%BB%8B/" style="font-size: 10px;">简介</a> <a href="/tags/%E7%BD%91%E7%BB%9C%E5%8D%8F%E8%AE%AE/" style="font-size: 10px;">网络协议</a> <a href="/tags/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/" style="font-size: 10px;">设计模式</a> <a href="/tags/%E8%BF%9B%E7%A8%8B%E4%B8%8E%E7%BA%BF%E7%A8%8B/" style="font-size: 10px;">进程与线程</a>
					</div>
				</section>
				
				
				

				
			</div>
		</div>
	</header>				
</div>
    </div>
    <div class="mid-col">
      <nav id="mobile-nav">
  	<div class="overlay">
  		<div class="slider-trigger"></div>
  		<h1 class="header-author js-mobile-header hide"></h1>
  	</div>
	<div class="intrude-less">
		<header id="header" class="inner">
			<div class="profilepic">
				<img lazy-src="https://bucket-chao.oss-cn-shanghai.aliyuncs.com/test/avatar.jpg" class="js-avatar">
			</div>
			<hgroup>
			  <h1 class="header-author"></h1>
			</hgroup>
			
			<nav class="header-menu">
				<ul>
				
					<li><a href="/">主页</a></li>
		        
					<li><a href="/archives">所有文章</a></li>
		        
		        <div class="clearfix"></div>
				</ul>
			</nav>
			<nav class="header-nav">
				<div class="social">
					
				</div>
			</nav>
		</header>				
	</div>
</nav>
      <div class="body-wrap"><article id="post-趣谈网络协议" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2022/02/16/%E8%B6%A3%E8%B0%88%E7%BD%91%E7%BB%9C%E5%8D%8F%E8%AE%AE/" class="article-date">
  	<time datetime="2022-02-16T11:53:19.000Z" itemprop="datePublished">2022-02-16</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      趣谈网络协议
      
    </h1>
  

      </header>
      
      <div class="article-info article-info-post">
        
	<div class="article-tag tagcloud">
		<ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E7%BD%91%E7%BB%9C%E5%8D%8F%E8%AE%AE/" rel="tag">网络协议</a></li></ul>
	</div>

        
	<div class="article-category tagcloud">
	<a class="article-category-link" href="/categories/%E7%BD%91%E7%BB%9C%E5%8D%8F%E8%AE%AE/">网络协议</a>
	</div>


        
        <div class="clearfix"></div>
      </div>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="通信协议综述"><a href="#通信协议综述" class="headerlink" title="通信协议综述"></a>通信协议综述</h1><h2 id="为什么要学习网络协议？"><a href="#为什么要学习网络协议？" class="headerlink" title="为什么要学习网络协议？"></a>为什么要学习网络协议？</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">要打造互联网世界的通天塔，只教给一台机器做什么是不够的，你需要学会教给一大片机器做什么。这就需要网络协议</span><br><span class="line">通过网络协议，才能使一大片机器互相协作、共同完成一件事。</span><br></pre></td></tr></table></figure>

<p><img src="/2022/02/16/%E8%B6%A3%E8%B0%88%E7%BD%91%E7%BB%9C%E5%8D%8F%E8%AE%AE/%E7%BD%91%E7%BB%9C%E5%8D%8F%E8%AE%AE%E5%88%97%E4%B8%BE.png" alt="网络协议列举"></p>
<h2 id="网络分层"><a href="#网络分层" class="headerlink" title="网络分层"></a>网络分层</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">为什么分层： 复杂的程序都分层，程序设计要求</span><br><span class="line"></span><br><span class="line">层层封装： 只要是在网络上跑的包，都是完整的。可以有下层没上层，绝对不可能有上层没下层。</span><br></pre></td></tr></table></figure>

<h2 id="ifconfig-命令"><a href="#ifconfig-命令" class="headerlink" title="ifconfig 命令"></a>ifconfig 命令</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">linux 查看ip地址： ifconfig，   ip addr   （工具： net-tools 和 iproute2  的故事）</span><br><span class="line"></span><br><span class="line">大部分的网卡都会有一个 IP 地址, 不是必需</span><br><span class="line">IP 地址是一个网卡在网络世界的通讯地址, 相当于门牌号， 不可冲突</span><br><span class="line"></span><br><span class="line">例： </span><br><span class="line">    10.100.122.2 就是一个 IP 地址。这个地址被点分隔为四个部分，每个部分 8 个 bit，所以 IP 地址总共是 32 位</span><br><span class="line">    因为不够用，于是就有了 IPv6，也就是上面输出结果里面 inet6 fe80::f816:3eff:fec7:7975/64。这个有 128 位</span><br></pre></td></tr></table></figure>

<p>当初设计哪知道现在会有这么多计算机， 本来 32 位的 IP 地址就不够，还被分成了 5 类<br><img src="/2022/02/16/%E8%B6%A3%E8%B0%88%E7%BD%91%E7%BB%9C%E5%8D%8F%E8%AE%AE/32%E4%BD%8DIP%E5%9C%B0%E5%9D%80%E5%88%86%E7%B1%BB.png" alt="32位IP地址分类"></p>
<p><img src="/2022/02/16/%E8%B6%A3%E8%B0%88%E7%BD%91%E7%BB%9C%E5%8D%8F%E8%AE%AE/ABC%E7%B1%BBIP%E6%9C%80%E5%A4%A7%E4%B8%BB%E6%9C%BA%E6%95%B0.png" alt="ABC类IP最大主机数"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">对于 A、B、 C 类主要分两部分，前面一部分是网络号，后面一部分是主机号</span><br><span class="line"></span><br><span class="line">问题： </span><br><span class="line">    C 类地址能包含的最大主机数量实在太少了，只有 254 个</span><br><span class="line">    而 B 类地址能包含的最大主机数量又太多了, 一般企业达不到6万多台机器， 闲着浪费</span><br></pre></td></tr></table></figure>

<ul>
<li>无类型域间选路（CIDR）</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">将 32 位的 IP 地址一分为二，前面是网络号，后面是主机号</span><br><span class="line">例： </span><br><span class="line">    10.100.122.2/24</span><br><span class="line">    这种地址表示形式，就是 CIDR。后面 24 的意思是，32 位中，前 24 位是网络号，后 8 位是主机号      </span><br><span class="line">    </span><br><span class="line">伴随着 CIDR 存在的:</span><br><span class="line">    一个是广播地址，10.100.122.255。如果发送这个地址，所有 10.100.122 网络里面的机器都可以收到</span><br><span class="line">    另一个是子网掩码，255.255.255.0</span><br><span class="line">    </span><br><span class="line">将子网掩码和 IP 地址按位计算 AND，就可得到网络号:   如上面例子网络号就是： 10.100.122.0    </span><br></pre></td></tr></table></figure>

<ul>
<li>公有 IP 地址和私有 IP 地址</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">日常工作现在都是 CIDR, 几乎不用划分 A 类、B 类或者 C 类.</span><br><span class="line"></span><br><span class="line">私有IP： 是一个组织内部的， 公网之间可以重复</span><br><span class="line">公有IP： 是分配的的，需要买</span><br><span class="line"></span><br><span class="line">在ABC类IP地址中， 私有IP在上图中</span><br><span class="line">CIDR中常见的是 /24 的私有IP， 如: 192.168.0.x , 一般私有网络的出口地址，像路由器是 192.168.0.1， 而192.168.0.255是广播地址</span><br></pre></td></tr></table></figure>

<ul>
<li>D类组播地址</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">使用这一类地址，属于某个组的机器都能收到。</span><br></pre></td></tr></table></figure>

<h3 id="ip-addr-的继续分析"><a href="#ip-addr-的继续分析" class="headerlink" title="ip addr 的继续分析"></a>ip addr 的继续分析</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">root@test:~# ip addr</span><br><span class="line">1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue state UNKNOWN group default </span><br><span class="line">    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00</span><br><span class="line">    inet 127.0.0.1/8 scope host lo</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">    inet6 ::1/128 scope host </span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">2: eth0: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc pfifo_fast state UP group default qlen 1000</span><br><span class="line">    link/ether fa:16:3e:c7:79:75 brd ff:ff:ff:ff:ff:ff</span><br><span class="line">    inet 10.100.122.2/24 brd 10.100.122.255 scope global eth0</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">    inet6 fe80::f816:3eff:fec7:7975/64 scope link </span><br><span class="line">       valid_lft forever preferred_lft forever</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">在 IP 地址的后面有个 scope</span><br><span class="line">    对于 eth0 这张网卡来讲，是 global，说明这张网卡是可以对外的，可以接收来自各个地方的包。</span><br><span class="line">    对于 lo 来讲，是 host，说明这张网卡仅仅可以供本机相互通信。</span><br><span class="line">    </span><br><span class="line">lo 全称是 loopback，又称环回接口，往往会被分配到 127.0.0.1 这个地址。</span><br><span class="line">这个地址用于本机通信，经过内核处理后直接返回，不会在任何网络中出现。    </span><br></pre></td></tr></table></figure>

<ul>
<li>MAC 地址</li>
</ul>
<blockquote>
<p>在 IP 地址的上一行是 link/ether fa:16:3e:c7:79:75 brd ff:ff:ff:ff:ff:ff，这个被称为 MAC 地址，是一个网卡的物理地址，用十六进制，6 个 byte 表示</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">号称 全局唯一， 不会有两个网卡有相同的 MAC 地址，而且网卡自生产出来，就带着这个地址</span><br><span class="line"></span><br><span class="line">误解：MAC地址唯一，那整个互联网的通信，全部用 MAC 地址好了，只要知道了对方的 MAC 地址，就可以把信息传过去。</span><br><span class="line"></span><br><span class="line">正解： 一个网络包要从一个地方传到另一个地方，除了要有确定的地址，还需要有定位功能。 而有门牌号码属性的 IP 地址，才是有远程定位功能的</span><br><span class="line"></span><br><span class="line">MAC 地址更像是身份证，是一个唯一的标识</span><br><span class="line"></span><br><span class="line">MAC 地址是有一定定位功能的，只不过范围非常有限， 局限在一个子网里面。 </span><br><span class="line">例： 从 192.168.0.2/24 访问 192.168.0.3/24 是可以用 MAC 地址的。  </span><br></pre></td></tr></table></figure>

<ul>
<li>网络设备的状态标识</li>
</ul>
<blockquote>
<p>&lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; 是干什么的？这个叫做 net_device flags，网络设备的状态标识。</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">UP 表示网卡处于启动的状态；</span><br><span class="line">BROADCAST 表示这个网卡有广播地址，可以发送广播包；</span><br><span class="line">MULTICAST 表示网卡可以发送多播包；</span><br><span class="line">LOWER_UP 表示 L1 是启动的，也即网线插着呢。</span><br></pre></td></tr></table></figure>

<ul>
<li>MTU1500</li>
</ul>
<blockquote>
<p>MTU1500 是指什么意思呢？是哪一层的概念呢？最大传输单元 MTU 为 1500，这是以太网的默认值。</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">MTU 是二层 MAC 层的概念。</span><br><span class="line">MAC 层有 MAC 的头，以太网规定正文部分不允许超过 1500 个字节。</span><br><span class="line">正文里面有 IP 的头、TCP 的头、HTTP 的头。如果放不下，就需要分片来传输。</span><br></pre></td></tr></table></figure>

<ul>
<li>qdisc 排队规则</li>
</ul>
<blockquote>
<p>qdisc pfifo_fast 是什么意思呢？qdisc 全称是 queueing discipline，中文叫排队规则。</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">内核如果需要通过某个网络接口发送数据包，它都需要按照为这个接口配置的 qdisc（排队规则）把数据包加入队列</span><br><span class="line"></span><br><span class="line">队列类型： </span><br><span class="line">    pfifo :  最简单， 先进先出</span><br><span class="line">    pfifo_fast : </span><br><span class="line">        它的队列包括三个波段（band）。在每个波段里面，使用先进先出规则。</span><br><span class="line">        三个波段（band）的优先级也不相同。band 0 最高，band 2 最低。 如果 band 0 里面有数据包，系统就不会处理 band 1 里面的数据包</span><br><span class="line">        数据包是按照服务类型（Type of Service，TOS）被分配到三个波段（band）里面的。TOS 是 IP 头里面的一个字段，代表了当前的包是高优先级的，还是低优先级的        </span><br></pre></td></tr></table></figure>

<h3 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h3><ul>
<li>IP 是地址，有定位功能；MAC 是身份证，无定位功能；</li>
<li>CIDR 可以用来判断是不是本地人；</li>
<li>IP 分公有的 IP 和私有的 IP</li>
</ul>
<h2 id="DHCP-和-PXE-：-IP怎么来？-怎么没？"><a href="#DHCP-和-PXE-：-IP怎么来？-怎么没？" class="headerlink" title="DHCP 和 PXE ： IP怎么来？ 怎么没？"></a>DHCP 和 PXE ： IP怎么来？ 怎么没？</h2><h3 id="如何配置IP地址"><a href="#如何配置IP地址" class="headerlink" title="如何配置IP地址"></a>如何配置IP地址</h3><p>使用 net-tools</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> sudo ifconfig eth1 10.0.0.1/24</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> sudo ifconfig eth1 up</span></span><br></pre></td></tr></table></figure>

<p>使用 iproute2：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> sudo ip addr add 10.0.0.1/24 dev eth1</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> sudo ip link <span class="built_in">set</span> up eth1</span></span><br></pre></td></tr></table></figure>

<ul>
<li>思考： 192.168.1.6 就在你这台机器的旁边，甚至是在同一个交换机上，而你把机器的地址设为了 16.158.23.6。 为什么ping不通？</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">原则： 只要是在网络上跑的包，都是完整的，可以有下层没上层，绝对不可能有上层没下层。</span><br><span class="line"></span><br><span class="line">逻辑分析： </span><br><span class="line">    它有自己的源 IP 地址 16.158.23.6，也有目标 IP 地址 192.168.1.6，但是包发不出去，这是因为 MAC 层还没填</span><br><span class="line">    </span><br><span class="line">    Linux 首先会判断，要去的这个地址和我是一个网段的吗，或者和我的一个网卡是同一网段的吗？</span><br><span class="line">    只有是一个网段的，它才会发送 ARP 请求，获取 MAC 地址</span><br><span class="line">    如果不是， 这是一个跨网段的调用，它便不会直接将包发送到网络上，而是企图将包发送到网关。</span><br><span class="line">    而linux中网关的配置， 网关要和当前的网络至少一个网卡是同一个网段的</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">不同系统的配置文件格式不同，但是无非就是 CIDR、子网掩码、广播地址和网关地址。</span><br></pre></td></tr></table></figure>

<h3 id="动态主机配置协议（DHCP）（Dynamic-Host-Configuration-Protocol）"><a href="#动态主机配置协议（DHCP）（Dynamic-Host-Configuration-Protocol）" class="headerlink" title="动态主机配置协议（DHCP）（Dynamic Host Configuration Protocol）"></a>动态主机配置协议（DHCP）（Dynamic Host Configuration Protocol）</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">他只需要配置一段共享的 IP 地址。</span><br><span class="line">每一台新接入的机器都通过 DHCP 协议，来这个共享的 IP 地址里申请，然后自动配置好就可以了。</span><br><span class="line">等人走了，或者用完了，还回去，这样其他的机器也能用。</span><br></pre></td></tr></table></figure>

<ul>
<li>DHCP 工作方式 新机器加入网络</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">第一步. client进行 DHCP Discover （ 广播 Boot request，我的 MAC 地址是这个，我还没有 IP)</span><br><span class="line">    新机器使用 IP 地址 0.0.0.0 发送了一个广播包，目的 IP 地址为 255.255.255.255。广播包封装了 UDP，UDP 封装了 BOOTP。 （其实 DHCP 是 BOOTP 的增强版）</span><br><span class="line">    </span><br><span class="line">第二步. DHCP server 进行 DHCP offer</span><br><span class="line">    MAC地址唯一，新MAC地址来了，分配IP地址，并为他保留 。  仍然使用广播地址作为目的地址    </span><br><span class="line">    </span><br><span class="line">第三步，client 进行 DHCP request</span><br><span class="line">    新机器得到 offer， 如果有多个DHCP server， 甚至得到多个offer</span><br><span class="line">    一般选择最新到达的offer，然后向网络发送一个 DHCP Request 广播数据包，包中包含客户端的 MAC 地址、接受的租约中的 IP 地址、提供此租约的 DHCP 服务器地址等    </span><br><span class="line">    告诉所有 DHCP Server 它将接受哪一台服务器提供的 IP 地址，告诉其他 DHCP 服务器，谢谢你们的接纳，并请求撤销它们提供的 IP 地址，以便提供给下一个 IP 租用请求者</span><br><span class="line">    由于还没有得到 DHCP Server 的最后确认，客户端仍然使用 0.0.0.0 为源 IP 地址、255.255.255.255 为目标地址进行广播</span><br><span class="line"></span><br><span class="line">第四步， server 进行 DHCP ACK    </span><br><span class="line">    当 DHCP Server 接收到客户机的 DHCP request 之后，</span><br><span class="line">    会广播返回给客户机一个 DHCP ACK 消息包，表明已经接受客户机的选择，并将这一 IP 地址的合法租用信息和其他的配置信息都放入该广播包，发给客户机，欢迎它加入网络大家庭。</span><br><span class="line">    广播也是告诉其他server， 该client在我这个server租了IP</span><br></pre></td></tr></table></figure>

<ul>
<li>IP地址的收回和续租</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">续租： </span><br><span class="line">    客户机会在租期过去 50% 的时候，直接向为其提供 IP 地址的 DHCP Server 发送 DHCP request 消息包</span><br><span class="line">    客户机接收到该服务器回应的 DHCP ACK 消息包，会根据包中所提供的新的租期以及其他已经更新的 TCP/IP 参数，更新自己的配置</span><br></pre></td></tr></table></figure>

<h3 id="自动安装操作系统"><a href="#自动安装操作系统" class="headerlink" title="自动安装操作系统"></a>自动安装操作系统</h3><ul>
<li>预启动执行环境（PXE）</li>
</ul>
<blockquote>
<p>场景： 数据中心里面的管理员可能一下子就拿到几百台空的机器，一个个安装操作系统，会累死的</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">办法： 安装的操作系统放在一个服务器上，让客户端去下载。 </span><br><span class="line">问题： 没有操作系统，客户端放哪里？ </span><br><span class="line">解决： </span><br><span class="line">    操作系统的启动过程:  首先启动BIOS, 读取硬盘的 MBR 启动扇区，将 GRUB 启动起来；然后将权力交给 GRUB，GRUB 加载内核、加载作为根文件系统的 initramfs 文件；然后将权力交给内核；最后内核启动，初始化整个操作系统</span><br><span class="line">    在整个过程中, 只能放在BIOS启动后,因为没安装系统之前，连启动扇区都没有</span><br><span class="line">    这个过程叫做预启动执行环境（Pre-boot Execution Environment），简称 PXE。 </span><br><span class="line">    PXE 协议分为客户端和服务器端，由于还没有操作系统，只能先把客户端放在 BIOS 里面。当计算机启动时，BIOS 把 PXE 客户端调入内存里面，就可以连接到服务端做一些操作了</span><br><span class="line">    </span><br><span class="line">    首先 PXE 的客户端启动起来，发送一个 DHCP 的请求，让 DHCP Server 给它分配一个地址。PXE 客户端有了自己的地址</span><br><span class="line">    怎么知道 PXE 服务器在哪里呢？  在DHCP server 中配置  next-server，指向 PXE 服务器的地址，配置初始启动文件位置 filename</span><br><span class="line">    然后TFTP，从 PXE服务器下载</span><br></pre></td></tr></table></figure>

<p>PXE 工作过程</p>
<p><img src="/2022/02/16/%E8%B6%A3%E8%B0%88%E7%BD%91%E7%BB%9C%E5%8D%8F%E8%AE%AE/PXE%E5%B7%A5%E4%BD%9C%E8%BF%87%E7%A8%8B.png" alt="PXE工作过程"></p>

      
    </div>
    
  </div>
  
    
<nav id="article-nav">
  
  
    <a href="/2022/02/15/%E5%8D%B3%E6%97%B6%E6%B6%88%E6%81%AF%E6%8A%80%E6%9C%AF%E5%AD%A6%E4%B9%A0/" id="article-nav-older" class="article-nav-link-wrap">
      <div class="article-nav-title">即时消息技术学习</div>
      <strong class="article-nav-caption">&gt;</strong>
    </a>
  
</nav>

  
</article>


<div class="ds-share share" data-thread-key="趣谈网络协议" data-title="趣谈网络协议" data-url="http://wczj.github.io/2022/02/16/%E8%B6%A3%E8%B0%88%E7%BD%91%E7%BB%9C%E5%8D%8F%E8%AE%AE/"  data-images="https://bucket-chao.oss-cn-shanghai.aliyuncs.com/test/avatar.jpg" data-content="趣谈网络协议">
    <div class="ds-share-inline">
      <ul  class="ds-share-icons-16">
      	<li data-toggle="ds-share-icons-more"><a class="ds-more" href="javascript:void(0);">分享到：</a></li>
        <li><a class="ds-weibo" href="javascript:void(0);" data-service="weibo">微博</a></li>
        <li><a class="ds-qzone" href="javascript:void(0);" data-service="qzone">QQ空间</a></li>
        <li><a class="ds-qqt" href="javascript:void(0);" data-service="qqt">腾讯微博</a></li>
        <li><a class="ds-wechat" href="javascript:void(0);" data-service="wechat">微信</a></li>
      </ul>
      <div class="ds-share-icons-more">
      </div>
    </div>
 </div>
 





</div>
      <footer id="footer">
  <div class="outer">
    <div id="footer-info">
      <div class="footer-left">
        &copy; 2022 王大炮
      </div>
        <div class="footer-right">
          <a href="http://hexo.io/" target="_blank">Hexo</a>  Theme <a href="https://github.com/smackgg/hexo-theme-smackdown" target="_blank">Smackdown</a>
        </div>
    </div>
  </div>
</footer>
    </div>
    
  
<link rel="stylesheet" href="/fancybox/jquery.fancybox.css">



<script>
	var yiliaConfig = {
		fancybox: true,
		mathjax: true,
		animate: true,
		isHome: false,
		isPost: true,
		isArchive: false,
		isTag: false,
		isCategory: false,
		open_in_new: false
	}
</script>

<script src="/js/main.js"></script>




<script type="text/x-mathjax-config">
MathJax.Hub.Config({
    tex2jax: {
        inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
        processEscapes: true,
        skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
    }
});

MathJax.Hub.Queue(function() {
    var all = MathJax.Hub.getAllJax(), i;
    for(i=0; i < all.length; i += 1) {
        all[i].SourceElement().parentNode.className += ' has-jax';                 
    }       
});
</script>

<script src="//cdn.bootcss.com/mathjax/2.7.0/MathJax.js"></script>


  </div>
</body>
</html>